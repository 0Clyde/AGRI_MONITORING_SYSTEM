<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Livestock Details</title>
    <link rel="stylesheet" href="farmerslivestock_info.css">
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="goBack()">←</button>
    <h1 class="title" id="farmerTitle">Farmer – Livestock Details</h1>

    <div class="header-actions">
        <button class="btn secondary" id="editBtn">Edit</button>
    </div>
</header>

<main class="main-container">
    
    <section class="farmer-info-card">
        <h2 class="section-title">Farmer Information</h2>
        <div class="farmer-info-row">
            <div>
                <span class="label">Name:</span>
                <span id="farmerName">—</span>
            </div>
            <div>
                <span class="label">Contact:</span>
                <span id="farmerContact">—</span>
            </div>
            <div>
                <span class="label">Age:</span>
                <span id="farmerAge">—</span>
            </div>
            <div>
                <span class="label">Sex:</span>
                <span id="farmerSex">—</span>
            </div>
            <div>
                <span class="label">Barangay:</span>
                <span id="farmerBarangay">—</span>
            </div>
            <div>
                <span class="label">Farmer ID:</span>
                <span id="farmerIdLabel">—</span>
            </div>
        </div>
    </section>

   
    <section class="livestock-section">
        <div class="livestock-header">
            <h2 class="section-title">Livestock and Details</h2>
            <span class="section-subtitle">Shows list of livestock and number of animals.</span>
        </div>

        <div class="table-wrapper">
            <table class="livestock-table">
                <thead>
                    <tr>
                        <th>Animal Type</th>
                        <th>Number of Animals (M)</th>
                        <th>Number of Animals (F)</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="livestockTableBody">
                    
                </tbody>
            </table>
        </div>
    </section>

    
    <section class="high-value-section">
        <div class="right-panel">
            <h3>Livestock Summary</h3>

            <label>Total Animals (Male):</label>
            <input type="text" id="totalMale" disabled>

            <label>Total Animals (Female):</label>
            <input type="text" id="totalFemale" disabled>

            <label>Grand Total:</label>
            <input type="text" id="grandTotal" disabled>
        </div>
    </section>
</main>

<script>
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function goBack() {
    const barangay = getQueryParam("barangay") || "";
    if (barangay) {
        window.location.href = `Livestock_Overview.html?barangay=${encodeURIComponent(barangay)}`;
    } else {
        window.history.back();
    }
}

document.addEventListener("DOMContentLoaded", async () => {
    const barangay = getQueryParam("barangay") || "";
    const farmerId = getQueryParam("farmerId") || "";
    
    if (!barangay || !farmerId) {
        alert("Missing barangay or farmer ID!");
        return;
    }
    
    await loadFarmerDetails(barangay, farmerId);
});


document.getElementById("editBtn").addEventListener("click", () => {
    const barangay = getQueryParam("barangay") || "";
    const farmerId = getQueryParam("farmerId") || "";
    
    
    window.location.href = `Livestock_edit.html?barangay=${encodeURIComponent(barangay)}&farmerId=${encodeURIComponent(farmerId)}`;
});

async function loadFarmerDetails(barangayParam, farmerIdParam) {
    const tbody = document.getElementById("livestockTableBody");

    try {
        console.log(`Fetching farmer ${farmerIdParam} in barangay ${barangayParam}`);
        const response = await fetch(`/api/livestock/${barangayParam}/${farmerIdParam}`);
        
        if (!response.ok) {
            throw new Error(`Failed to load farmer livestock: ${response.statusText}`);
        }

        const farmer = await response.json();
        console.log("Farmer detail:", farmer);

        
        document.getElementById("farmerName").textContent = farmer.farmerName || "Unnamed Farmer";
        document.getElementById("farmerContact").textContent = farmer.contact || "N/A";
        document.getElementById("farmerAge").textContent = farmer.age || "N/A";
        document.getElementById("farmerSex").textContent = farmer.sex || "N/A";
        document.getElementById("farmerBarangay").textContent = farmer.barangay || "Unknown";
        document.getElementById("farmerIdLabel").textContent = farmer.id || "N/A";

        
        renderLivestockTable(farmer);

    } catch (err) {
        console.error(err);
        alert("Error loading farmer data: " + err.message);
        tbody.innerHTML = `<tr><td colspan="4" class="empty-row">Error loading data.</td></tr>`;
    }
}

function renderLivestockTable(farmer) {
    const tbody = document.getElementById("livestockTableBody");
    tbody.innerHTML = "";

    
    const animalTypes = [
        { name: "Cattle", maleField: "cattle_male", femaleField: "cattle_female" },
        { name: "Carabao", maleField: "carabao_male", femaleField: "carabao_female" },
        { name: "Horse", maleField: "horse_male", femaleField: "horse_female" },
        { name: "Goat", maleField: "goat_male", femaleField: "goat_female" },
        { name: "Sheep", maleField: "sheep_male", femaleField: "sheep_female" },
        { name: "Swine", maleField: "swine_male", femaleField: "swine_female" },
        { name: "Chicken", maleField: "chicken_male", femaleField: "chicken_female" },
        { name: "Duck", maleField: "duck_male", femaleField: "duck_female" },
        { name: "Quail", maleField: "quail_male", femaleField: "quail_female" },
        { name: "Turkey", maleField: "turkey_male", femaleField: "turkey_female" },
        { name: "Geese", maleField: "geese_male", femaleField: "geese_female" },
        { name: "Dove", maleField: "dove_male", femaleField: "dove_female" },
        { name: "Ostrich", maleField: "ostrich_male", femaleField: "ostrich_female" },
        { name: "Guinea Fowl", maleField: "guinea_fowl_male", femaleField: "guinea_fowl_female" },
        { name: "Game Fowl", maleField: "game_fowl_male", femaleField: "game_fowl_female" },
        { name: "Rabbit", maleField: "rabbit_male", femaleField: "rabbit_female" },
        { name: "Dog", maleField: "dog_male", femaleField: "dog_female" },
        { name: "Cat", maleField: "cat_male", femaleField: "cat_female" }
    ];

    let totalMale = 0;
    let totalFemale = 0;

    
    animalTypes.forEach(animal => {
        const maleCount = farmer[animal.maleField] || 0;
        const femaleCount = farmer[animal.femaleField] || 0;
        const total = maleCount + femaleCount;

        
        if (total > 0) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${animal.name}</td>
                <td>${maleCount}</td>
                <td>${femaleCount}</td>
                <td>${total}</td>
            `;
            tbody.appendChild(tr);

            totalMale += maleCount;
            totalFemale += femaleCount;
        }
    });

    
    if (totalMale === 0 && totalFemale === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="empty-row">No livestock records yet.</td></tr>`;
    }

  
    document.getElementById("totalMale").value = totalMale;
    document.getElementById("totalFemale").value = totalFemale;
    document.getElementById("grandTotal").value = totalMale + totalFemale;
}
</script>

</body>
</html>